<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- CRM Activity Dashboard List View -->
    <record id="view_crm_activity_dashboard_tree" model="ir.ui.view">
        <field name="name">crm.activity.dashboard.tree</field>
        <field name="model">crm.activity.dashboard</field>
        <field name="arch" type="xml">
            <tree string="CRM Activities Dashboard" 
                  decoration-danger="state == 'overdue'"
                  decoration-warning="state == 'today'"
                  decoration-info="state == 'tomorrow'"
                  decoration-muted="state == 'planned'"
                  decoration-success="state == 'done'"
                  create="false" 
                  edit="false"
                  default_order="date_deadline asc, priority desc">
                
                <!-- Activity Information -->
                <field name="state" widget="badge" 
                       decoration-danger="state == 'overdue'"
                       decoration-warning="state == 'today'"
                       decoration-info="state == 'tomorrow'"
                       decoration-muted="state == 'planned'"
                       decoration-success="state == 'done'"/>
                
                <field name="activity_type_id" string="Activity Type"/>
                <field name="summary" string="Summary" width="300px"/>
                <field name="date_deadline" string="Due Date"/>
                <field name="days_overdue" string="Days Overdue" 
                       attrs="{'invisible': [('state', '!=', 'overdue')]}"/>
                
                <!-- Customer Information -->
                <field name="partner_id" string="Customer"/>
                
                <!-- User and Priority -->
                <field name="user_id" string="Assigned To" widget="many2one_avatar_user"/>
                <field name="priority" string="Priority" widget="priority"/>
                
                <!-- Hidden fields for filtering -->
                <field name="activity_color" invisible="1"/>
                <field name="is_active" invisible="1"/>
                <field name="activity_id" invisible="1"/>
                <field name="lead_id" invisible="1"/>
                <field name="company_currency" invisible="1"/>
                <field name="date_done" invisible="1"/>
            </tree>
        </field>
    </record>

    <!-- CRM Activity Dashboard Form View -->
    <record id="view_crm_activity_dashboard_form" model="ir.ui.view">
        <field name="name">crm.activity.dashboard.form</field>
        <field name="model">crm.activity.dashboard</field>
        <field name="arch" type="xml">
            <form string="CRM Activity Details" create="false" edit="false">
                <header>
                    <button name="action_mark_done" 
                            string="Mark as Done" 
                            type="object" 
                            class="btn-primary"
                            attrs="{'invisible': [('state', '=', 'done')]}"/>
                    <button name="action_schedule_next" 
                            string="Schedule Next" 
                            type="object" 
                            class="btn-secondary"
                            attrs="{'invisible': [('state', '=', 'done')]}"/>
                    <button name="action_open_activity" 
                            string="Edit Activity" 
                            type="object" 
                            class="btn-secondary"/>
                    <button name="action_open_lead" 
                            string="Open Lead" 
                            type="object" 
                            class="btn-primary"/>
                    <field name="state" widget="statusbar"/>
                </header>
                
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="summary" placeholder="Activity Summary"/>
                        </h1>
                        <h2>
                            <field name="lead_name" readonly="1"/>
                        </h2>
                    </div>
                    
                    <group>
                        <group string="Activity Details">
                            <field name="activity_type_id"/>
                            <field name="date_deadline"/>
                            <field name="date_done" attrs="{'invisible': [('state', '!=', 'done')]}"/>
                            <field name="days_overdue" attrs="{'invisible': [('state', '!=', 'overdue')]}"/>
                            <field name="priority" widget="priority"/>
                            <field name="user_id" widget="many2one_avatar_user"/>
                            <field name="request_partner_id"/>
                        </group>
                        
                        <group string="Lead/Opportunity Details">
                            <field name="lead_type"/>
                            <field name="partner_id"/>
                            <field name="stage_id"/>
                            <field name="team_id"/>
                            <field name="expected_revenue" widget="monetary"/>
                            <field name="probability"/>
                            <field name="company_currency" invisible="1"/>
                        </group>
                    </group>
                    
                    <group string="Contact Information">
                        <field name="lead_email" widget="email"/>
                        <field name="lead_phone" widget="phone"/>
                    </group>
                    
                    <notebook>
                        <page string="Notes">
                            <field name="note" widget="html" readonly="1"/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- CRM Activity Dashboard Search View -->
    <record id="view_crm_activity_dashboard_search" model="ir.ui.view">
        <field name="name">crm.activity.dashboard.search</field>
        <field name="model">crm.activity.dashboard</field>
        <field name="arch" type="xml">
            <search string="Search CRM Activities">
                <!-- Search fields -->
                <field name="summary" string="Summary" 
                       filter_domain="[('summary', 'ilike', self)]"/>
                <field name="lead_name" string="Lead/Opportunity" 
                       filter_domain="[('lead_name', 'ilike', self)]"/>
                <field name="user_id" string="Assigned To"/>
                <field name="team_id" string="Sales Team"/>
                <field name="activity_type_id" string="Activity Type"/>
                <field name="partner_id" string="Customer"/>
                <field name="stage_id" string="Stage"/>
                
                <!-- Status Filters -->
                <separator/>
                <filter name="overdue" string="Overdue" 
                        domain="[('state', '=', 'overdue')]"
                        help="Activities that are overdue"/>
                <filter name="today" string="Today" 
                        domain="[('state', '=', 'today')]"
                        help="Activities due today"/>
                <filter name="tomorrow" string="Tomorrow" 
                        domain="[('state', '=', 'tomorrow')]"
                        help="Activities due tomorrow"/>
                <filter name="planned" string="Planned" 
                        domain="[('state', '=', 'planned')]"
                        help="Future planned activities"/>
                <filter name="done" string="Done" 
                        domain="[('state', '=', 'done')]"
                        help="Completed activities"/>
                
                <separator/>
                
                <!-- Time-based Filters -->
                <filter name="my_activities" string="My Activities" 
                        domain="[('user_id', '=', uid)]"
                        help="Activities assigned to me"/>
                        
                <separator/>
                
                <!-- Date Filters -->
                <filter name="filter_yesterday" string="Yesterday"
                        domain="[('date_deadline', '=', (context_today() - datetime.timedelta(days=1)))]"/>
                <filter name="filter_today" string="Today"
                        domain="[('date_deadline', '=', context_today())]"/>
                <filter name="filter_tomorrow" string="Tomorrow"
                        domain="[('date_deadline', '=', (context_today() + datetime.timedelta(days=1)))]"/>
                
                <separator/>
                
                <filter name="filter_last_7_days" string="Last 7 Days"
                        domain="[('date_deadline', '&gt;=', (context_today() - datetime.timedelta(days=7))),
                                ('date_deadline', '&lt;=', context_today())]"/>
                <filter name="filter_next_7_days" string="Next 7 Days"
                        domain="[('date_deadline', '&gt;=', context_today()),
                                ('date_deadline', '&lt;=', (context_today() + datetime.timedelta(days=7)))]"/>
                
                <separator/>
                
                <filter name="filter_last_30_days" string="Last 30 Days"
                        domain="[('date_deadline', '&gt;=', (context_today() - datetime.timedelta(days=30))),
                                ('date_deadline', '&lt;=', context_today())]"/>
                <filter name="filter_next_30_days" string="Next 30 Days"
                        domain="[('date_deadline', '&gt;=', context_today()),
                                ('date_deadline', '&lt;=', (context_today() + datetime.timedelta(days=30)))]"/>
                
                <separator/>
                
                <filter name="filter_this_year" string="This Year"
                        domain="[('date_deadline', '&gt;=', context_today().strftime('%Y-01-01')),
                                ('date_deadline', '&lt;=', context_today().strftime('%Y-12-31'))]"/>
                <filter name="filter_last_year" string="Last Year"
                        domain="[('date_deadline', '&gt;=', (context_today() - datetime.timedelta(days=365)).strftime('%Y-01-01')),
                                ('date_deadline', '&lt;=', (context_today() - datetime.timedelta(days=365)).strftime('%Y-12-31'))]"/>
                
                <!-- Type Filters -->
                <separator/>
                <filter name="leads" string="Leads" 
                        domain="[('lead_type', '=', 'lead')]"
                        help="Activities from Leads"/>
                <filter name="opportunities" string="Opportunities" 
                        domain="[('lead_type', '=', 'opportunity')]"
                        help="Activities from Opportunities"/>
                
                <!-- Priority Filters -->
                <separator/>
                <filter name="high_priority" string="High Priority" 
                        domain="[('priority', 'in', ['2', '3'])]"
                        help="High and Very High priority activities"/>
                
                <!-- Active Filter -->
                <separator/>
                <filter name="active_activities" string="Active Activities" 
                        domain="[('is_active', '=', True)]"
                        help="Only active (not done) activities"/>
                
                <!-- Group By -->
                <group expand="0" string="Group By">
                    <filter name="group_state" string="Status" 
                            domain="[]" context="{'group_by': 'state'}"/>
                    <filter name="group_user" string="Assigned To" 
                            domain="[]" context="{'group_by': 'user_id'}"/>
                    <filter name="group_team" string="Sales Team" 
                            domain="[]" context="{'group_by': 'team_id'}"/>
                    <filter name="group_activity_type" string="Activity Type" 
                            domain="[]" context="{'group_by': 'activity_type_id'}"/>
                    <filter name="group_stage" string="Stage" 
                            domain="[]" context="{'group_by': 'stage_id'}"/>
                    <filter name="group_deadline" string="Due Date" 
                            domain="[]" context="{'group_by': 'date_deadline'}"/>
                    <filter name="group_priority" string="Priority" 
                            domain="[]" context="{'group_by': 'priority'}"/>
                    <filter name="group_lead_type" string="Lead Type" 
                            domain="[]" context="{'group_by': 'lead_type'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Dashboard Kanban View -->
    <record id="view_crm_activity_dashboard_kanban" model="ir.ui.view">
        <field name="name">crm.activity.dashboard.kanban</field>
        <field name="model">crm.activity.dashboard</field>
        <field name="arch" type="xml">
            <kanban string="CRM Activities Dashboard" 
                    create="false" 
                    edit="false"
                    default_group_by="state">
                <field name="state"/>
                <field name="activity_type_id"/>
                <field name="summary"/>
                <field name="lead_name"/>
                <field name="user_id"/>
                <field name="date_deadline"/>
                <field name="days_overdue"/>
                <field name="priority"/>
                <field name="activity_color"/>
                <field name="expected_revenue"/>
                <field name="team_id"/>
                <field name="partner_id"/>
                
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click" 
                             t-att-style="'border-left: 5px solid ' + record.activity_color.raw_value">
                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="summary"/>
                                        </strong>
                                        <br/>
                                        <small class="text-muted">
                                            <field name="lead_name"/>
                                        </small>
                                    </div>
                                    <div class="o_kanban_record_body">
                                        <div>
                                            <i class="fa fa-calendar"/> 
                                            <field name="date_deadline"/>
                                            <t t-if="record.days_overdue.raw_value > 0">
                                                <span class="text-danger">
                                                    (<field name="days_overdue"/> days overdue)
                                                </span>
                                            </t>
                                        </div>
                                        <div>
                                            <i class="fa fa-tag"/> 
                                            <field name="activity_type_id"/>
                                        </div>
                                        <div t-if="record.partner_id.raw_value">
                                            <i class="fa fa-building"/> 
                                            <field name="partner_id"/>
                                        </div>
                                        <div t-if="record.expected_revenue.raw_value">
                                            <i class="fa fa-money"/> 
                                            <field name="expected_revenue" widget="monetary"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="oe_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left">
                                        <field name="priority" widget="priority"/>
                                        <field name="user_id" widget="many2one_avatar_user"/>
                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <field name="team_id" groups="sales_team.group_sale_salesman_all_leads"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Dashboard Pivot View -->
    <record id="view_crm_activity_dashboard_pivot" model="ir.ui.view">
        <field name="name">crm.activity.dashboard.pivot</field>
        <field name="model">crm.activity.dashboard</field>
        <field name="arch" type="xml">
            <pivot string="CRM Activities Analysis">
                <field name="user_id" type="row"/>
                <field name="state" type="col"/>
                <field name="activity_id" type="measure"/>
            </pivot>
        </field>
    </record>

    <!-- Dashboard Graph View -->
    <record id="view_crm_activity_dashboard_graph" model="ir.ui.view">
        <field name="name">crm.activity.dashboard.graph</field>
        <field name="model">crm.activity.dashboard</field>
        <field name="arch" type="xml">
            <graph string="CRM Activities Statistics" type="bar">
                <field name="state"/>
                <field name="activity_id" type="measure"/>
            </graph>
        </field>
    </record>

</odoo>
